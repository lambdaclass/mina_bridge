// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.4.16 <0.9.0;

import "pasta/Fields.sol";
import "poseidon/Sponge.sol";

contract MerkleVerifier {
    enum LeftOrRight {
        Left,
        Right
    }

    struct PathElement {
        Pasta.Fp hash;
        LeftOrRight left_or_right;
    }

    function calc_path_root(
        PathElement[] memory merkle_path,
        Pasta.Fp leaf_hash,
        Poseidon poseidon
    ) public view returns (Pasta.Fp) {
        Pasta.Fp acc = leaf_hash;

        for (uint256 i = 0; i < merkle_path.length; i++) {
            Poseidon.Sponge memory sponge = poseidon.new_sponge();
            poseidon.absorb(sponge, salt_values[i]);

            if (merkle_path[i].left_or_right == LeftOrRight.Left) {
                poseidon.absorb(sponge, acc);
                poseidon.absorb(sponge, merkle_path[i].hash);
            } else {
                poseidon.absorb(sponge, merkle_path[i].hash);
                poseidon.absorb(sponge, acc);
            }

            (sponge, acc) = poseidon.squeeze(sponge);
        }

        return acc;
    }

    Pasta.Fp[100] internal salt_values = [
        Pasta.Fp.wrap(240717916736854740746536336786608778143903672653),
        Pasta.Fp.wrap(240717916736854761028945940438279202091154958669),
        Pasta.Fp.wrap(240717916736854781311355544089949626038406244685),
        Pasta.Fp.wrap(240717916736854801593765147741620049985657530701),
        Pasta.Fp.wrap(240717916736854821876174751393290473932908816717),
        Pasta.Fp.wrap(240717916736854842158584355044960897880160102733),
        Pasta.Fp.wrap(240717916736854862440993958696631321827411388749),
        Pasta.Fp.wrap(240717916736854882723403562348301745774662674765),
        Pasta.Fp.wrap(240717916736854903005813165999972169721913960781),
        Pasta.Fp.wrap(240717916736854720543354895649202691790196336973),
        Pasta.Fp.wrap(240717916736854740825764499300873115737447622989),
        Pasta.Fp.wrap(240717916736854761108174102952543539684698909005),
        Pasta.Fp.wrap(240717916736854781390583706604213963631950195021),
        Pasta.Fp.wrap(240717916736854801672993310255884387579201481037),
        Pasta.Fp.wrap(240717916736854821955402913907554811526452767053),
        Pasta.Fp.wrap(240717916736854842237812517559225235473704053069),
        Pasta.Fp.wrap(240717916736854862520222121210895659420955339085),
        Pasta.Fp.wrap(240717916736854882802631724862566083368206625101),
        Pasta.Fp.wrap(240717916736854903085041328514236507315457911117),
        Pasta.Fp.wrap(240717916736854720622583058163467029383740287309),
        Pasta.Fp.wrap(240717916736854740904992661815137453330991573325),
        Pasta.Fp.wrap(240717916736854761187402265466807877278242859341),
        Pasta.Fp.wrap(240717916736854781469811869118478301225494145357),
        Pasta.Fp.wrap(240717916736854801752221472770148725172745431373),
        Pasta.Fp.wrap(240717916736854822034631076421819149119996717389),
        Pasta.Fp.wrap(240717916736854842317040680073489573067248003405),
        Pasta.Fp.wrap(240717916736854862599450283725159997014499289421),
        Pasta.Fp.wrap(240717916736854882881859887376830420961750575437),
        Pasta.Fp.wrap(240717916736854903164269491028500844909001861453),
        Pasta.Fp.wrap(240717916736854720701811220677731366977284237645),
        Pasta.Fp.wrap(240717916736854740984220824329401790924535523661),
        Pasta.Fp.wrap(240717916736854761266630427981072214871786809677),
        Pasta.Fp.wrap(240717916736854781549040031632742638819038095693),
        Pasta.Fp.wrap(240717916736854801831449635284413062766289381709),
        Pasta.Fp.wrap(240717916736854822113859238936083486713540667725),
        Pasta.Fp.wrap(240717916736854842396268842587753910660791953741),
        Pasta.Fp.wrap(240717916736854862678678446239424334608043239757),
        Pasta.Fp.wrap(240717916736854882961088049891094758555294525773),
        Pasta.Fp.wrap(240717916736854903243497653542765182502545811789),
        Pasta.Fp.wrap(240717916736854720781039383191995704570828187981),
        Pasta.Fp.wrap(240717916736854741063448986843666128518079473997),
        Pasta.Fp.wrap(240717916736854761345858590495336552465330760013),
        Pasta.Fp.wrap(240717916736854781628268194147006976412582046029),
        Pasta.Fp.wrap(240717916736854801910677797798677400359833332045),
        Pasta.Fp.wrap(240717916736854822193087401450347824307084618061),
        Pasta.Fp.wrap(240717916736854842475497005102018248254335904077),
        Pasta.Fp.wrap(240717916736854862757906608753688672201587190093),
        Pasta.Fp.wrap(240717916736854883040316212405359096148838476109),
        Pasta.Fp.wrap(240717916736854903322725816057029520096089762125),
        Pasta.Fp.wrap(240717916736854720860267545706260042164372138317),
        Pasta.Fp.wrap(240717916736854741142677149357930466111623424333),
        Pasta.Fp.wrap(240717916736854761425086753009600890058874710349),
        Pasta.Fp.wrap(240717916736854781707496356661271314006125996365),
        Pasta.Fp.wrap(240717916736854801989905960312941737953377282381),
        Pasta.Fp.wrap(240717916736854822272315563964612161900628568397),
        Pasta.Fp.wrap(240717916736854842554725167616282585847879854413),
        Pasta.Fp.wrap(240717916736854862837134771267953009795131140429),
        Pasta.Fp.wrap(240717916736854883119544374919623433742382426445),
        Pasta.Fp.wrap(240717916736854903401953978571293857689633712461),
        Pasta.Fp.wrap(240717916736854720939495708220524379757916088653),
        Pasta.Fp.wrap(240717916736854741221905311872194803705167374669),
        Pasta.Fp.wrap(240717916736854761504314915523865227652418660685),
        Pasta.Fp.wrap(240717916736854781786724519175535651599669946701),
        Pasta.Fp.wrap(240717916736854802069134122827206075546921232717),
        Pasta.Fp.wrap(240717916736854822351543726478876499494172518733),
        Pasta.Fp.wrap(240717916736854842633953330130546923441423804749),
        Pasta.Fp.wrap(240717916736854862916362933782217347388675090765),
        Pasta.Fp.wrap(240717916736854883198772537433887771335926376781),
        Pasta.Fp.wrap(240717916736854903481182141085558195283177662797),
        Pasta.Fp.wrap(240717916736854721018723870734788717351460038989),
        Pasta.Fp.wrap(240717916736854741301133474386459141298711325005),
        Pasta.Fp.wrap(240717916736854761583543078038129565245962611021),
        Pasta.Fp.wrap(240717916736854781865952681689799989193213897037),
        Pasta.Fp.wrap(240717916736854802148362285341470413140465183053),
        Pasta.Fp.wrap(240717916736854822430771888993140837087716469069),
        Pasta.Fp.wrap(240717916736854842713181492644811261034967755085),
        Pasta.Fp.wrap(240717916736854862995591096296481684982219041101),
        Pasta.Fp.wrap(240717916736854883278000699948152108929470327117),
        Pasta.Fp.wrap(240717916736854903560410303599822532876721613133),
        Pasta.Fp.wrap(240717916736854721097952033249053054945003989325),
        Pasta.Fp.wrap(240717916736854741380361636900723478892255275341),
        Pasta.Fp.wrap(240717916736854761662771240552393902839506561357),
        Pasta.Fp.wrap(240717916736854781945180844204064326786757847373),
        Pasta.Fp.wrap(240717916736854802227590447855734750734009133389),
        Pasta.Fp.wrap(240717916736854822510000051507405174681260419405),
        Pasta.Fp.wrap(240717916736854842792409655159075598628511705421),
        Pasta.Fp.wrap(240717916736854863074819258810746022575762991437),
        Pasta.Fp.wrap(240717916736854883357228862462416446523014277453),
        Pasta.Fp.wrap(240717916736854903639638466114086870470265563469),
        Pasta.Fp.wrap(240717916736854721177180195763317392538547939661),
        Pasta.Fp.wrap(240717916736854741459589799414987816485799225677),
        Pasta.Fp.wrap(240717916736854761741999403066658240433050511693),
        Pasta.Fp.wrap(240717916736854782024409006718328664380301797709),
        Pasta.Fp.wrap(240717916736854802306818610369999088327553083725),
        Pasta.Fp.wrap(240717916736854822589228214021669512274804369741),
        Pasta.Fp.wrap(240717916736854842871637817673339936222055655757),
        Pasta.Fp.wrap(240717916736854863154047421325010360169306941773),
        Pasta.Fp.wrap(240717916736854883436457024976680784116558227789),
        Pasta.Fp.wrap(240717916736854903718866628628351208063809513805),
        Pasta.Fp.wrap(240717916736854720464436218144759699265377167693)
    ];
}
