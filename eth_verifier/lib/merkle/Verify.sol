// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.4.16 <0.9.0;

import "pasta/Fields.sol";
import "poseidon/Pasta.sol";

contract MerkleVerifier {
    enum LeftOrRight {
        Left,
        Right
    }

    struct PathElement {
        Pasta.Fp hash;
        LeftOrRight left_or_right;
    }

    function calc_path_root(
        PathElement[] memory merkle_path,
        Pasta.Fp leaf_hash,
        Poseidon poseidon
    ) public view returns (Pasta.Fp) {
        Pasta.Fp acc = leaf_hash;
        Poseidon.Sponge memory sponge = poseidon.new_sponge();

        for (uint256 i = 0; i < merkle_path.length; i++) {
            sponge.state[0] = salt_values[i * 3];
            sponge.state[1] = salt_values[i * 3 + 1];
            sponge.state[2] = salt_values[i * 3 + 2];

            if (merkle_path[i].left_or_right == LeftOrRight.Left) {
                sponge = poseidon.absorb(sponge, acc);
                sponge = poseidon.absorb(sponge, merkle_path[i].hash);
            } else {
                sponge = poseidon.absorb(sponge, merkle_path[i].hash);
                sponge = poseidon.absorb(sponge, acc);
            }

            (sponge, acc) = poseidon.squeeze(sponge);
        }

        return acc;
    }

    Pasta.Fp[199] internal salt_values = [
        Pasta.from(
            8397268313679062041369959431253823194029931472150942928062160502284391094281
        ),
        Pasta.from(
            24767884761786058961844271624848183563027832662151526765582126547150580343286
        ),
        Pasta.from(
            15520161476079946346223794435136450862321049619449569410496603974021593252201
        ),
        Pasta.from(
            12373852158717286419843731546435335382149645091717657472272709119680142489615
        ),
        Pasta.from(
            13564003298811293044133692367818358732199958610489782205113648738971877309993
        ),
        Pasta.from(
            5337043262085238844960907983211959910580364187637104432942748885155441259131
        ),
        Pasta.from(
            15051812550454916172932351641588540140427950452718257831984749683884179659477
        ),
        Pasta.from(
            28383195182051628320454520194171815630993209993126957580698595309541504912011
        ),
        Pasta.from(
            4277691878710291748308373204686233213493236676960343422888557635834505390473
        ),
        Pasta.from(
            6575607106027019342374634884807079936125440627705088279356425488661046931690
        ),
        Pasta.from(
            526224612349672274315011399400566806883023700724847451269254308717318755497
        ),
        Pasta.from(
            4003207773096098875040917033101823533304203798100315080652105415888406223352
        ),
        Pasta.from(
            24963240007694741581504536598446662705874548366155724154174858737449434658477
        ),
        Pasta.from(
            3025643334447992593201368502593388460692780911680818037147500927887943605498
        ),
        Pasta.from(
            17577291971615136405466944877064852825800866932005309965300049909875838083076
        ),
        Pasta.from(
            11625519336224216740433997623839523639549293720171430638848267458495647838261
        ),
        Pasta.from(
            14197827690168556134026805733901328807809311762374992007209622464122527394871
        ),
        Pasta.from(
            24909546339148248646747762490876591451430974658068769530058833648954096301456
        ),
        Pasta.from(
            20496141241824212441237352225390586578798287226209999878764321364949616437960
        ),
        Pasta.from(
            4155590369081069691345914612081918410248481482116023511739814856893535749559
        ),
        Pasta.from(
            25280235590916436988517501437699802702512719636909687680088402215172012465734
        ),
        Pasta.from(
            10298068926909347382132883731000773194312572157088286708479172422210086260995
        ),
        Pasta.from(
            14412862431845107093626156618901720148499279341044373322107997590840338638158
        ),
        Pasta.from(
            18738278293927842151520671915277777211638038066182255367951771829184874598427
        ),
        Pasta.from(
            28632592040294076899303724277173923788865287530305670556694222869732793988004
        ),
        Pasta.from(
            14134336299867672225741933845142646509776280694779004162993533642733541282015
        ),
        Pasta.from(
            28037399410478206961594894531712592987717708818866863005767179190210518183828
        ),
        Pasta.from(
            28322440793030270460307522165077799886504360112793805560745845785393893720792
        ),
        Pasta.from(
            3680990636041985093510751436516424061735738733660682549379374982251492126646
        ),
        Pasta.from(
            7896824890513378496611723513283689788600212799489558200026291296328182622221
        ),
        Pasta.from(
            1478825754917601949043978332728751378179798684550333324122027096810422078645
        ),
        Pasta.from(
            19955446483411426559697602372431961972639316232014088927090908136220581190127
        ),
        Pasta.from(
            22937261898125224845285209761802309482795401959887338893419704202246881755471
        ),
        Pasta.from(
            3025669655948979260146450778546273335663805909503078623788468939889184085065
        ),
        Pasta.from(
            15993847354573651974906488175776892699808218007882158173582011967178852672755
        ),
        Pasta.from(
            6728962834255630075044411175238909144357249010478126045082535701512206099100
        ),
        Pasta.from(
            4677165292950275428044379611682530196143565581952109747023715412205031133122
        ),
        Pasta.from(
            21513899673761352699672092079955767010402365369617552725870531290648558067173
        ),
        Pasta.from(
            5823386711670711136557441661686775439019939642112594994252954772574341048476
        ),
        Pasta.from(
            4137450619603133353679529278148472140169709465994051450094506977210968350741
        ),
        Pasta.from(
            20777878603100506442428451439085789382190751853558867746947762486311334171694
        ),
        Pasta.from(
            27969424486066619381654224557897167292901506145568220790334189049235066613665
        ),
        Pasta.from(
            7462353831830439752760657933641455151117269082035084708085558232378403435178
        ),
        Pasta.from(
            1787244519320006617494344121814759180988090836648336932002915182844592150859
        ),
        Pasta.from(
            7682306724592829108592527309756770669512991144597346665572702844909814248134
        ),
        Pasta.from(
            12849982892801603879697133836957604723592408109307896931233575279534184819695
        ),
        Pasta.from(
            27109175861581264256359157262042451197946512419680432940872313012019233881553
        ),
        Pasta.from(
            13815104575456051899693190094329831931582197916170277640933492195480185919492
        ),
        Pasta.from(
            6644594317394622409746632037064067639690803096240195936787541353591870145229
        ),
        Pasta.from(
            11503303739151441813791807558499068063822922776334355558577285976158398952971
        ),
        Pasta.from(
            9337125879737469121869180649342064063336965090821029559184624332617319461193
        ),
        Pasta.from(
            16104414183099799176590675567463444044322697144434744941137050377134055108298
        ),
        Pasta.from(
            17358877713925634221311853575857896650017793698150943722268889332978652414223
        ),
        Pasta.from(
            7234126597295300967301107936467282549695978865424211233580228640451399578381
        ),
        Pasta.from(
            17030714373021103124485584722642520216144771996601835120521405613273080127695
        ),
        Pasta.from(
            26509950438240323122836106956137067463028271669140328718474012128935499432293
        ),
        Pasta.from(
            9818889955393545543887790759741008577636326202190253983607321653665940190431
        ),
        Pasta.from(
            2270411531086562128123060093007384197084198453711890037231329803621300858719
        ),
        Pasta.from(
            21192327485899043676835708468201514580084416399939158033379551466586666938111
        ),
        Pasta.from(
            16033989106273371309578845565218498940092011786025881685960320194668952032796
        ),
        Pasta.from(
            24198821385641779512630219367024089801694762674171638444197433117564329069692
        ),
        Pasta.from(
            17399215024068249103454892742127252703846599060950907551709080066119343928674
        ),
        Pasta.from(
            6797496550859701647209308902606013125966581359799331801777446461476502619719
        ),
        Pasta.from(
            15260363122901687259348044007172490341059494245069079855983853109440904252201
        ),
        Pasta.from(
            21842382560395200222478365766257143008580907092198481707074219770380221343296
        ),
        Pasta.from(
            19876442709041612567866226719534012751674476537343454328432936802993088542055
        ),
        Pasta.from(
            10163265845587027789352563667609980510844248093141311984644246724416434726269
        ),
        Pasta.from(
            13369107363202464111086659762824590159914641657154062683624651983805608000703
        ),
        Pasta.from(
            259175261445126704640807316250901216510411826120741654939526054707099272571
        ),
        Pasta.from(
            25461412540439968937539737336272713843660028687121793297700520674608023616092
        ),
        Pasta.from(
            10755893000209302712577283259218096030828962406298481790491258793159046533447
        ),
        Pasta.from(
            8866387537961409494137849949417794325538964245944495058838310355591599158861
        ),
        Pasta.from(
            10609060102237336747496673704618826236585593118726760088941627829244492026235
        ),
        Pasta.from(
            6641853671926028367004819143507613339775735721213578606129119394262986889972
        ),
        Pasta.from(
            9176598236393962999771652301435919857376442200780273350376009302991599772639
        ),
        Pasta.from(
            8743110049886111146439413671080530377154252710287926017043338548443560750915
        ),
        Pasta.from(
            18208706295395849104423491533560000448355322792628322573027110778397939938163
        ),
        Pasta.from(
            2334327064299326913052261993744862803507079864714736582625500368508312407812
        ),
        Pasta.from(
            5402818389523730021623225031229797943489634186744070457165886896537635439065
        ),
        Pasta.from(
            3692115584159570188352953749250318597861823862334166671448537184963748474804
        ),
        Pasta.from(
            6395188055016804845192781987569287073677422173381065069566010090740896063910
        ),
        Pasta.from(
            23003820738793392288354347717848227276238967632076473726115713990146403158695
        ),
        Pasta.from(
            1543444712754301638361713310613005045560110448825211620606741790481631721785
        ),
        Pasta.from(
            25595274127363608001744519321284450036093000747866790144244029941400855918414
        ),
        Pasta.from(
            1371490494959146551400088557556657100677286767912367568372761029147549710248
        ),
        Pasta.from(
            9732076291970119043155961140210107725581877672949581468560495192803834949972
        ),
        Pasta.from(
            25880816593631896400945395886425311206250378130295778852027160152013445398428
        ),
        Pasta.from(
            5026966843162353429404633270081859806361860129654116093869475139616692501822
        ),
        Pasta.from(
            14399077456078098196809897303466976088446801284524532382221120510698115179718
        ),
        Pasta.from(
            19173688776848337916142856590169111672948615917148745778746830767290062051975
        ),
        Pasta.from(
            28464430208663194459267079800760461073547794864536029383346306150717295227411
        ),
        Pasta.from(
            28914474904259440678682001469840084119186056954595456498123242804122927256626
        ),
        Pasta.from(
            26203211860047183178968105249611310661035109372798510229151816437426414875870
        ),
        Pasta.from(
            10406444365958122823322321566809921419619436370846100318015238317663537713508
        ),
        Pasta.from(
            19324027736939870254907794657369430751886546066724762856165204189536200502231
        ),
        Pasta.from(
            27910908481683556223061499853457824695327274417786658997051526597466420105059
        ),
        Pasta.from(
            1799233325885428173215288721205732918055309618518578057591098186182492814731
        ),
        Pasta.from(
            9573156486615047627167271384099786785626031045209045718144391096893253044237
        ),
        Pasta.from(
            21011100500969260736212187791129169911216589801480194154796681238630801173303
        ),
        Pasta.from(
            3148460134537259154192780209825660438770489205065565102219398141630842726179
        ),
        Pasta.from(
            10416076901773723654263170420888517757942744365709722512723508899712187445722
        ),
        Pasta.from(
            9749070751601048371099954046702168187173097100747088073519924283619949053060
        ),
        Pasta.from(
            16036605154418397696690227738898261818934103448455753144542686857246049934251
        ),
        Pasta.from(
            13116195790811852398580983299275910910260911290232634459841017490947920635760
        ),
        Pasta.from(
            20914357145334136112903459144371894839046767011252485660349261543687439240515
        ),
        Pasta.from(
            27121734445981217282939510097696253631089706813569006868445891968460368567974
        ),
        Pasta.from(
            715381054565457856713917483767474125655250716827719934397684768568566660056
        ),
        Pasta.from(
            22926360198644867909959646760416396768171909013888923485856060088656762220146
        ),
        Pasta.from(
            15411651809728377007962749584457476958331475859761077254535733310493693863184
        ),
        Pasta.from(
            28283529960577247850724132686757276550945563071535771556525147218578304498394
        ),
        Pasta.from(
            25922771853751840452016161865146657836373548957490281948552979186327598832907
        ),
        Pasta.from(
            16985607528849256520800813920239971004020161818415619567540220894514586229304
        ),
        Pasta.from(
            21759631161250253412819730649091996554146268954819131804288171576179442703183
        ),
        Pasta.from(
            14185379935091709057677451650107357692478200566655934421145603846907748616347
        ),
        Pasta.from(
            10139623969245853142942647939794352363971890305001144925744686344768432613436
        ),
        Pasta.from(
            4421111367235812268043849200041120359372634026931186606123265274830057997512
        ),
        Pasta.from(
            21389957028543563343983452239402129073644559761574758599879018560061923362420
        ),
        Pasta.from(
            7331938067098234420518101146476976737427551752964139372872010490810144489016
        ),
        Pasta.from(
            19376988884406137004496470406503629881518631186358340469845420192342467563805
        ),
        Pasta.from(
            17872304858000314785294575941718223510390865153424166312722197492544922924913
        ),
        Pasta.from(
            14163654873939530767328342783891667616564781104875725993076782936179487580496
        ),
        Pasta.from(
            28483237868932771967301782384701310810170620108646314312148330158983522802675
        ),
        Pasta.from(
            5470444915351718161064738143984117404543180896557800110345214197194265945935
        ),
        Pasta.from(
            1151782396346300526721173166606959182539281926428010936118203586899270812937
        ),
        Pasta.from(
            17220611115538190327418731694513246567647093315703560541579145141454642783381
        ),
        Pasta.from(
            1827701865316296069049383790211497568669568043577110290390922485770125563378
        ),
        Pasta.from(
            15070264127752077435260386430251860418932583550153983365643440702231466899575
        ),
        Pasta.from(
            15194919748186792975629744016800115040585292259725675101847448679839390076465
        ),
        Pasta.from(
            636805707197841281951212111981719137394078290625544799415819737834042366160
        ),
        Pasta.from(
            16442733791103815253197097953879467639249399641678632863052732628234991617421
        ),
        Pasta.from(
            11178966020612557360436864928037347531128071660214471590599439968915809407106
        ),
        Pasta.from(
            16075878619164277785308904234316346117364814460051950789746369162516909748351
        ),
        Pasta.from(
            22864444441196501171668947273043710483755885360984717068883384069940103680603
        ),
        Pasta.from(
            15552030775865618995053022110254314047799118746559881590270437157643928361630
        ),
        Pasta.from(
            27368840290886590618253975690371515626817655889504997637028935625996549696676
        ),
        Pasta.from(
            20058629063058394394983677044793850223713849683627545433059369503226875567994
        ),
        Pasta.from(
            8237262439249888483067779498627588509748486081402680923639876317004867629284
        ),
        Pasta.from(
            8265376569801929985789997051724232870531692291281507317645663583990151550469
        ),
        Pasta.from(
            17434670191789857124968691368803795534480896874481190574177140567912418509246
        ),
        Pasta.from(
            14002330781338099238738543251674341674328098889382338607565673758476823790448
        ),
        Pasta.from(
            504651498436262888890803364631325475539745395303635220048090865595104556895
        ),
        Pasta.from(
            8134135731443781589467072276102904981615445672703916309840914945275033441326
        ),
        Pasta.from(
            5099664868227594302959167229049429228561240289248233817130624727290223895548
        ),
        Pasta.from(
            875402312783453401072708623488927113499771014348818375729969860221839479467
        ),
        Pasta.from(
            15913047357666720166343627242081167154639349090679778717007605497476987226193
        ),
        Pasta.from(
            9975247897759738303108049050883313400420507897199501068509102941286882005749
        ),
        Pasta.from(
            28725850790956942734610625767184652492296198441938388743520751076423634834981
        ),
        Pasta.from(
            1669657099202678127745750450082789089955683233518898573781895082707468957818
        ),
        Pasta.from(
            9966618902045619147550494693147870784109119635598691260404399390058583694468
        ),
        Pasta.from(
            20431326917844102521146349239364037864375655295823864748280225707892539862220
        )
    ];
}
